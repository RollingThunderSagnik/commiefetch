#!/usr/bin/env bash

XDG_CONFIG_HOME=${XDG_CONFIG_HOME:-${HOME}/.config}

# Get user
user="${USER-$(id -u -n)}"

# Get host
host="$(uname -n)"

#####################

# artist=$(python ~/.config/rofi/applets/applets/play_pause.py -f '{artist}')
# album=$(python ~/.config/rofi/applets/applets/play_pause.py -f '{album}')
# current=$(python ~/.config/rofi/applets/applets/play_pause.py -f '{song}')

#####################

read -rd '' config <<'EOF'
print_info() {

}
yoffset=1
xoffset=0
EOF

get_user_config() {
    # --config /path/to/config.conf
    if [[ -f "$config_file" ]]; then
        source "$config_file"
        err "Config: Sourced user config. (${config_file})"
        return

    elif [[ -f "${XDG_CONFIG_HOME}/commiefetch/config.conf" ]]; then
        source "${XDG_CONFIG_HOME}/commiefetch/config.conf"
        err "Config: Sourced user config.    (${XDG_CONFIG_HOME}/commiefetch/config.conf)"

    elif [[ -f "${XDG_CONFIG_HOME}/commiefetch/config" ]]; then
        source "${XDG_CONFIG_HOME}/commiefetch/config"
        err "Config: Sourced user config.    (${XDG_CONFIG_HOME}/commiefetch/config)"

    elif [[ -z "$no_config" ]]; then
        config_file="${XDG_CONFIG_HOME}/commiefetch/config.conf"

        # The config file doesn't exist, create it.
        mkdir -p "${XDG_CONFIG_HOME}/commiefetch/"
        printf '%s\n' "$config" > "$config_file"
    fi
}

# Colors and palette method stolen from dylanaraps pftech: https://github.com/dylanaraps/pfetch
c0='[0m'
c1='[31m'; c2='[32m'
c3='[33m'; c4='[34m'
c5='[35m'; c6='[36m'
c7='[37m'; c8='[38m'
c9='^[[37m'

palette="[7m$c1 $c1 $c2 $c2 $c3 $c3 $c4 $c4 $c5 $c5 $c6 $c6 [m"

RED='\033[0;31m'

bold=$(tput bold)
normal=$(tput sgr0)

ART1="${c0}${bold}             .\,       "
ART2="${c0}${bold}              +\*:     "
ART3="${c0}${bold}       ,+S##?  :#@+    "
ART4="${c0}${bold}     ,+S@@@%,   :@@+   "
ART5="${c0}${bold}     ,%@#S@@S\   %@#,  "
ART6="${c0}${bold}       *  \S@@%\ %@#,  "
ART7="${c0}${bold}    /@,     \S@@%@@*   "
ART8="${c0}${bold}  ,/@%@%+:,,,:%@@@#}   "
ART9="${c0}${bold} ,/@%/+S@@@@@@@@%#@&   "
ART0="${c0}${bold}  //      ''''   '&&}  "
ARTz="${c0}${bold}                       "


sovdiff=$(( ($(date +%s) - $(date -d "1991-12-25 UTC" +%s)) / (60*60*24) ))

get_args() {
    # Check the commandline flags early for '--config'.
    [[ "$*" != *--config* && "$*" != *--no_config* ]] && get_user_config

}

eval "$config"

get_args "$@"



# Print
cat <<-EOF

 ${ART1}    
 ${ART2}    ${c5}${bold}comrade${c0} ${bold}${user}
 ${ART3}    ${normal}${c0}of ${host}
 ${ART4}    
 ${ART5}    ${c5}${sovdiff} ${normal}days since USSR broke
 ${ART6}    
 ${ART7}    
 ${ART8}    
 ${ART9}    
 ${ART0}    
 
 ${ARTz}    ${c1}â–ˆâ–ˆâ–ˆ${c2}â–ˆâ–ˆâ–ˆ${c3}â–ˆâ–ˆâ–ˆ${c4}â–ˆâ–ˆâ–ˆ${c5}â–ˆâ–ˆâ–ˆ

EOF